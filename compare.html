<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compare PDF - PDFMitra</title>
    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        .cmp-container {
            max-width: 1400px;
            margin: 40px auto;
            padding: 0 20px;
            width: 100%;
        }

        .setup-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 40px;
        }

        .upload-card {
            background: white;
            padding: 40px;
            border-radius: 24px;
            border: 2px dashed var(--border);
            text-align: center;
            cursor: pointer;
            transition: 0.3s;
        }

        .upload-card:hover {
            border-color: var(--primary);
            background: #f0f7ff;
        }

        .comparison-viewer {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            width: 100%;
            background: #e2e8f0;
            padding: 20px;
            border-radius: 20px;
            min-height: 600px;
            margin-top: 20px;
        }

        .view-panel {
            background: white;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .view-header {
            width: 100%;
            padding: 10px;
            background: #f8fafc;
            border-bottom: 1px solid var(--border);
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--text-light);
            text-align: center;
        }

        .canvas-container {
            padding: 20px;
            display: flex;
            justify-content: center;
            overflow: auto;
            flex-grow: 1;
        }

        canvas {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            max-width: 100%;
        }

        .toolbar {
            background: white;
            padding: 10px 25px;
            border-radius: 50px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 20px;
            margin: 20px auto;
            width: fit-content;
            border: 1px solid var(--border);
        }

        .btn-nav {
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid var(--border);
            background: white;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="cmp-container">
        <h1>Compare PDF Documents</h1>
        <div id="cmpSetup" class="setup-grid">
            <div class="upload-card" onclick="document.getElementById('cmpFile1').click()">
                <div style="font-size:40px; color:var(--primary);"><i class="fas fa-file-pdf"></i></div>
                <h3>Original PDF</h3>
                <input type="file" id="cmpFile1" accept="application/pdf" style="display:none;">
            </div>
            <div class="upload-card" onclick="document.getElementById('cmpFile2').click()">
                <div style="font-size:40px; color:var(--primary);"><i class="fas fa-file-pdf"></i></div>
                <h3>Modified PDF</h3>
                <input type="file" id="cmpFile2" accept="application/pdf" style="display:none;">
            </div>
            <div style="grid-column: 1/-1; text-align:center; margin-top:20px;">
                <button id="cmpStartBtn" class="btn-nav"
                    style="background:var(--primary); color:white; padding:12px 40px;" disabled>Start
                    Comparison</button>
            </div>
        </div>
        <div id="cmpViewer" class="comparison-viewer" style="display:none;">
            <div class="view-panel">
                <div class="view-header">Original</div>
                <div class="canvas-container"><canvas id="cmpCanvas1"></canvas></div>
            </div>
            <div class="view-panel">
                <div class="view-header">Modified</div>
                <div class="canvas-container"><canvas id="cmpCanvas2"></canvas></div>
            </div>
            <div class="view-panel">
                <div class="view-header">Visual Diff</div>
                <div class="canvas-container"><canvas id="cmpCanvasDiff"></canvas></div>
            </div>
        </div>
        <div id="cmpToolbar" class="toolbar" style="display:none;">
            <button class="btn-nav" id="cmpPrev"><i class="fas fa-chevron-left"></i></button>
            <span id="cmpPageInfo">Page 1 / 1</span>
            <button class="btn-nav" id="cmpNext"><i class="fas fa-chevron-right"></i></button>
            <span style="border-left:1px solid #ddd; padding-left:15px;">Diffs: <span id="cmpDiffCount"
                    style="color:magenta; font-weight:700;">0</span></span>
        </div>
    </div>
    <script src="js/ui-core.js"></script>
    <script>
        (function () {
            let doc1 = null, doc2 = null, cur = 1, total = 0;
            const handle = async (e, idx) => {
                const f = e.target.files[0]; if (!f) return;
                const doc = await pdfjsLib.getDocument({ data: await f.arrayBuffer() }).promise;
                if (idx === 1) doc1 = doc; else doc2 = doc;
                if (doc1 && doc2) document.getElementById('cmpStartBtn').disabled = false;
            };
            document.getElementById('cmpFile1').onchange = e => handle(e, 1);
            document.getElementById('cmpFile2').onchange = e => handle(e, 2);
            document.getElementById('cmpStartBtn').onclick = () => {
                document.getElementById('cmpSetup').style.display = 'none';
                document.getElementById('cmpViewer').style.display = 'grid';
                document.getElementById('cmpToolbar').style.display = 'flex';
                total = Math.max(doc1.numPages, doc2.numPages);
                render(1);
            };
            async function render(n) {
                cur = n; const c1 = document.getElementById('cmpCanvas1'), c2 = document.getElementById('cmpCanvas2'), cd = document.getElementById('cmpCanvasDiff');
                if (n <= doc1.numPages) { const p = await doc1.getPage(n), vp = p.getViewport({ scale: 1.5 }); c1.width = vp.width; c1.height = vp.height; await p.render({ canvasContext: c1.getContext('2d'), viewport: vp }).promise; }
                if (n <= doc2.numPages) { const p = await doc2.getPage(n), vp = p.getViewport({ scale: 1.5 }); c2.width = vp.width; c2.height = vp.height; await p.render({ canvasContext: c2.getContext('2d'), viewport: vp }).promise; }
                cd.width = Math.max(c1.width, c2.width); cd.height = Math.max(c1.height, c2.height);
                diff(); document.getElementById('cmpPageInfo').innerText = `Page ${cur} / ${total}`;
            }
            function diff() {
                const c1 = document.getElementById('cmpCanvas1'), c2 = document.getElementById('cmpCanvas2'), cd = document.getElementById('cmpCanvasDiff'), ctxD = cd.getContext('2d');
                const i1 = c1.getContext('2d').getImageData(0, 0, c1.width, c1.height).data, i2 = c2.getContext('2d').getImageData(0, 0, c2.width, c2.height).data, id = ctxD.createImageData(cd.width, cd.height), dd = id.data;
                let cnt = 0;
                for (let i = 0; i < Math.min(i1.length, i2.length); i += 4) {
                    if (Math.abs(i1[i] - i2[i]) > 15) { dd[i] = 255; dd[i + 1] = 0; dd[i + 2] = 255; dd[i + 3] = 255; cnt++; }
                    else { const g = (i1[i] + i1[i + 1] + i1[i + 2]) / 3; dd[i] = g; dd[i + 1] = g; dd[i + 2] = g; dd[i + 3] = 50; }
                }
                ctxD.putImageData(id, 0, 0); document.getElementById('cmpDiffCount').innerText = cnt.toLocaleString();
            }
            document.getElementById('cmpPrev').onclick = () => cur > 1 && render(cur - 1);
            document.getElementById('cmpNext').onclick = () => cur < total && render(cur + 1);
        })();
    </script>
</body>

</html>