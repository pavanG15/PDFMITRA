<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF to Word - PDFMitra</title>
    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.umd.js"></script>
    <style>
        .p2w-container {
            max-width: 850px;
            margin: 40px auto;
            padding: 0 20px;
            flex-grow: 1;
            width: 100%;
        }

        .tool-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .tool-header h1 {
            font-size: 36px;
            font-weight: 800;
            margin-bottom: 12px;
        }

        .info-banner {
            padding: 16px 20px;
            border-radius: 20px;
            font-size: 14px;
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            gap: 14px;
            line-height: 1.6;
        }

        .privacy-banner {
            background: rgba(16, 185, 129, 0.08);
            color: #065f46;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .disclaimer-banner {
            background: rgba(25, 118, 210, 0.08);
            color: #1e40af;
            border: 1px solid rgba(25, 118, 210, 0.2);
            font-size: 13px;
        }

        .upload-section {
            background: white;
            padding: 60px 40px;
            border-radius: 32px;
            box-shadow: var(--shadow);
            text-align: center;
            border: 2px dashed #cbd5e1;
            transition: all 0.4s ease;
            cursor: pointer;
        }

        .upload-section:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
        }

        .upload-icon {
            font-size: 64px;
            color: var(--primary);
            margin-bottom: 24px;
        }

        .settings-card {
            background: white;
            border-radius: 32px;
            padding: 40px;
            box-shadow: var(--shadow);
            display: none;
            margin-bottom: 30px;
            border: 1px solid rgba(0, 137, 123, 0.1);
        }

        .mode-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .mode-card {
            border: 2px solid #e2e8f0;
            padding: 24px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mode-card.active {
            border-color: var(--primary);
            background: rgba(0, 137, 123, 0.05);
        }

        .progress-area {
            background: white;
            border-radius: 32px;
            padding: 50px;
            box-shadow: var(--shadow);
            display: none;
            text-align: center;
        }

        .progress-bar-container {
            width: 100%;
            height: 14px;
            background: #e2e8f0;
            border-radius: 10px;
            margin: 30px 0;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            width: 0%;
            background: var(--primary);
            border-radius: 10px;
            transition: width 0.4s;
        }

        .results-area {
            background: white;
            border-radius: 32px;
            padding: 50px;
            box-shadow: var(--shadow);
            display: none;
            text-align: center;
        }

        .success-icon {
            font-size: 80px;
            color: var(--success);
            margin-bottom: 24px;
        }

        .download-btn {
            background: var(--accent);
            color: white;
            padding: 18px 60px;
            border-radius: 20px;
            font-size: 20px;
            font-weight: 800;
            border: none;
            cursor: pointer;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            padding: 16px 40px;
            border-radius: 18px;
            font-weight: 700;
            border: none;
            cursor: pointer;
        }

        .btn-secondary {
            background: white;
            color: var(--text-dark);
            padding: 16px 40px;
            border-radius: 18px;
            font-weight: 700;
            border: 2px solid #e2e8f0;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="p2w-container">
        <div class="tool-header">
            <h1>PDF to Word</h1>
            <p>Convert your PDF documents to editable Microsoft Word files.</p>
        </div>
        <div class="info-banner privacy-banner"><i class="fas fa-shield-alt"></i><span><b>100% Secure & Local:</b> Files
                never leave your device.</span></div>
        <div class="info-banner disclaimer-banner"><i class="fas fa-info-circle"></i><span>Complex layouts may be
                simplified to ensure better editability.</span></div>
        <div class="upload-section" id="p2wDropZone">
            <div class="upload-icon"><i class="fas fa-cloud-upload-alt"></i></div>
            <p style="margin-bottom: 20px; font-weight: 600;">Drag & Drop PDF or Click to Select</p>
            <button class="btn-primary" id="p2wBrowseBtn">Choose PDF</button>
            <input type="file" id="p2wFileInput" accept="application/pdf" style="display: none;">
        </div>
        <div class="settings-card" id="p2wSettings">
            <div style="font-weight: 800; font-size: 20px; margin-bottom: 24px;">Conversion Settings</div>
            <p id="p2wFileInfo" style="font-size: 13px; color: var(--text-light); margin-bottom: 15px;"></p>
            <div class="mode-options">
                <div class="mode-card active" data-mode="hybrid">
                    <h4>Auto Hybrid</h4>
                    <p>Balanced extraction.</p>
                </div>
                <div class="mode-card" data-mode="flow">
                    <h4>Flow Mode</h4>
                    <p>Maximum editability.</p>
                </div>
            </div>
            <div style="display: flex; gap: 20px; margin-top: 30px;">
                <button class="btn-secondary" onclick="location.reload()">Change File</button>
                <button class="btn-primary" id="p2wConvertBtn" style="flex:1;">Convert to Word</button>
            </div>
        </div>
        <div class="progress-area" id="p2wProgress">
            <h2 id="p2wProgressTitle">Converting...</h2>
            <div class="progress-bar-container">
                <div class="progress-bar-fill" id="p2wBar"></div>
            </div>
            <p id="p2wStep" style="font-weight:600; color:var(--text-light);">Initializing...</p>
        </div>
        <div class="results-area" id="p2wResults">
            <div class="success-icon"><i class="fas fa-file-circle-check"></i></div>
            <h2>Complete!</h2>
            <p id="p2wFileNameDisplay" style="color: var(--text-light); margin: 10px 0 25px;"></p>
            <button class="download-btn" id="p2wDownloadBtn">Download Word Doc</button><br>
            <button class="btn-secondary" onclick="location.reload()" style="margin-top: 25px;">Convert Another</button>
        </div>
    </div>
    <script src="js/ui-core.js"></script>
    <script>
        (function () {
            const { Document, Packer, Paragraph, TextRun } = jspdf ? {} : window.docx || {}; // Fallback if docx not loaded
            // Use window.docx specifically
            const docxLib = window.docx;
            let originalFile = null, mode = 'hybrid';
            const fileInput = document.getElementById('p2wFileInput');
            document.getElementById('p2wBrowseBtn').onclick = () => fileInput.click();
            fileInput.onchange = e => handleFile(e.target.files[0]);
            async function handleFile(file) {
                if (!file || file.type !== 'application/pdf') return;
                originalFile = file;
                document.getElementById('p2wDropZone').style.display = 'none';
                document.getElementById('p2wSettings').style.display = 'block';
                document.getElementById('p2wFileInfo').innerHTML = `<b>${file.name}</b> (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
            }
            document.querySelectorAll('.mode-card').forEach(c => c.onclick = () => {
                document.querySelectorAll('.mode-card').forEach(x => x.classList.remove('active'));
                c.classList.add('active'); mode = c.dataset.mode;
            });
            document.getElementById('p2wConvertBtn').onclick = async () => {
                document.getElementById('p2wSettings').style.display = 'none';
                document.getElementById('p2wProgress').style.display = 'block';
                try {
                    const pdf = await pdfjsLib.getDocument({ data: await originalFile.arrayBuffer() }).promise;
                    const sections = [];
                    for (let i = 1; i <= pdf.numPages; i++) {
                        updateStep(`Processing ${i}/${pdf.numPages}`, (i / pdf.numPages) * 80);
                        const pg = await pdf.getPage(i), vp = pg.getViewport({ scale: 1 }), cnt = await pg.getTextContent();
                        const items = cnt.items.map(it => ({ text: it.str, y: Math.round(it.transform[5]), x: Math.round(it.transform[4]), h: it.height || 12, b: it.fontName?.toLowerCase().includes('bold') }));
                        items.sort((a, b) => b.y - a.y || a.x - b.x);
                        const children = []; let lastY = null, block = [];
                        items.forEach(it => {
                            if (lastY !== null && Math.abs(lastY - it.y) > 25) { renderBlock(block, children); block = []; }
                            block.push(it); lastY = it.y;
                        });
                        if (block.length) renderBlock(block, children);
                        sections.push({ children, properties: { page: { size: { width: vp.width * 20, height: vp.height * 20 } } } });
                    }
                    const blob = await docxLib.Packer.toBlob(new docxLib.Document({ sections }));
                    document.getElementById('p2wProgress').style.display = 'none';
                    document.getElementById('p2wResults').style.display = 'block';
                    document.getElementById('p2wFileNameDisplay').innerText = originalFile.name.replace('.pdf', '.docx');
                    document.getElementById('p2wDownloadBtn').onclick = () => {
                        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = originalFile.name.replace('.pdf', '.docx'); a.click();
                    };
                } catch (err) { alert("Failed"); location.reload(); }
            };
            function renderBlock(items, children) {
                const lines = {}; items.forEach(it => { if (!lines[it.y]) lines[it.y] = []; lines[it.y].push(it); });
                const runs = [];
                Object.keys(lines).sort((a, b) => b - a).forEach(y => {
                    let lastX = -999;
                    lines[y].sort((a, b) => a.x - b.x).forEach(it => {
                        runs.push(new docxLib.TextRun({ text: (lastX !== -999 && it.x - lastX > 2 ? " " : "") + it.text, bold: it.b, size: Math.round(it.h * 2) }));
                        lastX = it.x + (it.text.length * it.h * 0.45);
                    });
                    runs.push(new docxLib.TextRun({ text: " " }));
                });
                if (runs.length) children.push(new docxLib.Paragraph({ children: runs, spacing: { after: 200 } }));
            }
            function updateStep(t, p) { document.getElementById('p2wStep').innerText = t; document.getElementById('p2wBar').style.width = p + "%"; }
        })();
    </script>
</body>

</html>