<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Split PDF - PDFMitra</title>
  <!-- Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <style>
    .split-container {
      max-width: 900px;
      margin: 60px auto;
      padding: 0 20px;
      text-align: center;
    }

    .card {
      background: #fff;
      padding: 40px;
      border-radius: 24px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }

    .card h1 {
      font-size: 32px;
      margin-bottom: 10px;
    }

    .card p {
      color: var(--text-light);
      margin-bottom: 30px;
    }

    .upload-box {
      border: 2px dashed var(--primary);
      padding: 20px;
      border-radius: 16px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 12px;
      transition: all 0.3s;
      margin-bottom: 20px;
    }

    .upload-box:hover {
      background: rgba(0, 137, 123, 0.05);
    }

    .upload-box span {
      color: var(--primary);
      font-weight: 700;
    }

    #pdfFile {
      display: none;
    }

    .range-input {
      width: 100%;
      margin-top: 20px;
      padding: 15px;
      border-radius: 12px;
      border: 1px solid var(--border);
      font-size: 15px;
      outline: none;
    }

    .range-input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(0, 137, 123, 0.1);
    }

    .btn-primary {
      margin-top: 25px;
      padding: 16px 40px;
      border-radius: 50px;
      background: var(--primary);
      color: white;
      border: none;
      font-weight: 700;
      cursor: pointer;
      width: 100%;
      box-shadow: 0 10px 15px -3px rgba(0, 137, 123, 0.3);
    }

    .preview {
      margin-top: 30px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 15px;
    }

    .preview canvas {
      width: 100%;
      border-radius: 10px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }
  </style>
</head>

<body>
  <main class="split-container">
    <div class="card">
      <h1>Split PDF</h1>
      <p>Split PDF by custom page ranges. Example: <b>1-3, 5, 7-9</b></p>
      <label class="upload-box">
        <input type="file" id="pdfFile" accept="application/pdf" onchange="loadPDF()">
        <span><i class="fas fa-file-pdf"></i> Choose PDF File</span>
      </label>
      <input class="range-input" id="rangeInput" placeholder="Enter page ranges e.g. 1-3,5,7-9">
      <button class="btn-primary" onclick="splitPDF()">Split & Download (ZIP)</button>
      <div class="preview" id="preview"></div>
    </div>
  </main>

  <script src="js/ui-core.js"></script>
  <script>
    (function () {
      pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
      let pdfDoc = null;
      window.loadPDF = async function () {
        const file = document.getElementById("pdfFile").files[0]; if (!file) return;
        try {
          const buffer = await file.arrayBuffer();
          pdfDoc = await pdfjsLib.getDocument({ data: buffer }).promise;
          document.getElementById("preview").innerHTML = "";
          for (let i = 1; i <= Math.min(pdfDoc.numPages, 6); i++) {
            const page = await pdfDoc.getPage(i);
            const vp = page.getViewport({ scale: 0.3 });
            const canvas = document.createElement("canvas");
            canvas.width = vp.width; canvas.height = vp.height;
            await page.render({ canvasContext: canvas.getContext("2d"), viewport: vp }).promise;
            document.getElementById("preview").appendChild(canvas);
          }
        } catch (err) { alert("Error loading PDF: " + err.message); }
      }
      window.splitPDF = async function () {
        if (!pdfDoc) { alert("Please upload PDF"); return; }
        const ranges = document.getElementById("rangeInput").value.replace(/\s/g, "");
        if (!ranges) { alert("Enter page ranges"); return; }
        try {
          const zip = new JSZip();
          const srcPdf = await PDFLib.PDFDocument.load(await pdfDoc.getData());
          const parts = ranges.split(","); let index = 1;
          for (const part of parts) {
            let [start, end] = part.includes("-") ? part.split("-") : [part, part];
            start = parseInt(start); end = parseInt(end); if (isNaN(start) || isNaN(end)) continue;
            const newPdf = await PDFLib.PDFDocument.create();
            const maxPage = srcPdf.getPageCount();
            const aStart = Math.max(1, start); const aEnd = Math.min(maxPage, end);
            if (aStart > aEnd) continue;
            for (let i = aStart - 1; i < aEnd; i++) {
              const [page] = await newPdf.copyPages(srcPdf, [i]); newPdf.addPage(page);
            }
            const bytes = await newPdf.save(); zip.file(`split-${index}.pdf`, bytes); index++;
          }
          const blob = await zip.generateAsync({ type: "blob" });
          const url = URL.createObjectURL(blob); const a = document.createElement("a");
          a.href = url; a.download = "split-pdf.zip"; a.click(); URL.revokeObjectURL(url);
        } catch (err) { alert("Failed to split PDF: " + err.message); }
      }
    })();
  </script>
</body>

</html>